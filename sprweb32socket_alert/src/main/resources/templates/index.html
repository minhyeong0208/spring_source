<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>templates/index.html</title>
<!-- SockJSì™€ STOMP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½ê¸°ìš© -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script type="text/javascript">
let stompClient = null;

function connect() {
	let socket = new SockJS('/ws');  // /ws ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ WebSocket ì—°ê²° ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
	
	// í´ë¼ì´ì–¸íŠ¸ê°€ WebSocket ì—°ê²°ì„ í†µí•´ Stompë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
	stompClient = Stomp.over(socket);
	
	// ì—°ê²°ì— ì„±ê³µí•˜ë©´ ì½œë°± í•¨ìˆ˜ê°€ í˜¸ì¶œë¨
	stompClient.connect({}, function(frame) {  // frame: command, header, bodyë¡œ êµ¬ì„±
		console.log('connected : ' + frame);
		
		// '/topic/notifications'ì„ êµ¬ë…í•˜ì—¬, ì„œë²„ì—ì„œ ë©”ì„¸ì§€ë¥¼ ìˆ˜ì‹ 
		stompClient.subscribe('/topic/notifications', 
			function(noti) {
				let parseNoti = JSON.parse(noti.body);
				
				showNotiFunc(parseNoti.type, parseNoti.message);
			}
		);
	});
}

function sendRequest() {
	let fromUser = document.getElementById("fromUser").value;
	
	if(fromUser.trim() === "") {
		alert("ì‚¬ìš©ì ì´ë¦„ ì…ë ¥!");
		return;
	}
	
	stompClient.send("/app/friend-request", {}, fromUser);
}

function sendComment() {
	let fromUser = document.getElementById("fromUser").value;
	
	if(fromUser.trim() === "") {
		alert("ì‚¬ìš©ì ì´ë¦„ ì…ë ¥!");
		return;
	}
	
	stompClient.send("/app/comment", {}, fromUser);
}

function sendLike() {
	let fromUser = document.getElementById("fromUser").value;
	
	if(fromUser.trim() === "") {
		alert("ì‚¬ìš©ì ì´ë¦„ ì…ë ¥!");
		return;
	}
	
	stompClient.send("/app/like", {}, fromUser);
}

function showNotiFunc(type, message) {  // ì—¬ê¸°ì„œ ì¶œë ¥ë  ì˜ˆì •!
	//alert(type + ' ' + message);
	let notiList = document.getElementById("notiShow");
	let li = document.createElement("li");

	if(type === "ì¢‹ì•„ìš”") {
		li.innerHTML = `${type}:${message} ğŸ¶`;
	} else {
		li.appendChild(document.createTextNode(`${type}:${message} ğŸ¶`));
	}
	
	notiShow.appendChild(li);
}

window.onload = connect;
</script>
</head>
<body>
<h3>ì‹¤ì‹œê°„ ì•Œë¦¼</h3>
<div>
	ì‚¬ìš©ì ì´ë¦„ : 
	<input type="text" id="fromUser" placeholder="ì´ë¦„ ì…ë ¥">
</div>
<br>
<div>
	<b>ì´ë²¤íŠ¸ ë°œìƒ</b>
	<button onclick="sendRequest()">ì¹œêµ¬ ìš”ì²­</button>
	<button onclick="sendComment()">ëŒ“ê¸€ ì•Œë¦¼</button>
	<button onclick="sendLike()">ì¢‹ì•„ìš” ì•Œë¦¼</button>
</div>
<br/>
<div>
	<b>ì•Œë¦¼ : </b>
	<ul id="notiShow"></ul>
</div>
</body>
</html>